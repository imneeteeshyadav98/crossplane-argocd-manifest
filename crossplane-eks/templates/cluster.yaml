{{- if .Values.cluster.createCluster }}
apiVersion: eks.aws.crossplane.io/v1beta1
kind: Cluster
metadata:
  name: {{ .Values.cluster.name }}
spec:
  deletionPolicy: {{ .Values.cluster.deletionPolicy | default "Orphan" }}       # ✅ Prevents accidental deletion
  managementPolicy: {{ .Values.cluster.managementPolicy | default "FullControl" }} # ✅ Can be ObserveOnly if referencing existing EKS
  forProvider:
    region: {{ .Values.cluster.region }}
    version: {{ .Values.cluster.version | quote }}
    resourcesVpcConfig:
      endpointPrivateAccess: false
      endpointPublicAccess: true
      securityGroupIds:
{{- range .Values.cluster.securityGroupIds }}
        - {{ . | quote }}
{{- end }}
      subnetIds:
{{- range .Values.cluster.subnetIds }}
        - {{ . | quote }}
{{- end }}
    roleArn: {{ .Values.cluster.roleArn }}
  providerConfigRef:
    name: {{ .Values.providerConfig.name }}
  writeConnectionSecretToRef:
    name: {{ .Values.cluster.connectionSecret.name }}
    namespace: {{ .Values.cluster.connectionSecret.namespace }}
{{- end }}
